<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>フィボナッチ数列計算機〜JavaScriptとKotlin/Wasmの比較〜</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label, button {
            display: block;
            padding: 8px;
            width: 400px;
            margin: 20px auto;
            text-align: left;
        }
        input {
            width: 400px;
            padding: 8px;
            font-size: 16px;
            display: block;
            margin: 0 auto 15px;
        }
        button {
            padding: 10px;
            font-size: 16px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #4cae4c;
        }
        .results {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            gap: 20px;
        }
        .result-column {
            flex: 1;
            padding: 20px;
            background-color: #eef;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
        }
        .result-column h2 {
            margin-top: 0;
            color: #333;
        }
        .result-content {
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            min-height: 40px;
            word-wrap: break-word;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }
        .time-taken {
            margin-top: 10px;
            padding: 5px;
            background-color: #ffeeba;
            border-radius: 4px;
            font-size: 14px;
            color: #856404;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>フィボナッチ数列計算機
        <br>〜JavaScriptとKotlin/Wasmの比較〜
    </h1>

    <label for="numberInput">項数を入力してください（※42以下の値を推奨）:</label>
    <input type="number" id="numberInput" placeholder="例: 10">
    <button id="calculateBtn">計算する</button>
    <div class="results">
        <!-- JSの結果表示 -->
        <div class="result-column" id="javaScriptResult">
            <h2>JavaScriptでの実行結果</h2>
            <div class="result-content" id="javaScriptSequence"></div>
            <div class="time-taken" id="javaScriptTime"></div>
        </div>
        <!-- Wasmの結果表示 -->
        <div class="result-column" id="wasmResult">
            <h2>Kotlin/Wasmでの実行結果</h2>
            <div class="result-content" id="wasmSequence"></div>
            <div class="time-taken" id="wasmTime"></div>
        </div>
    </div>
</div>

<script type="module">
    console.log('スクリプトがロードされました。');

    let fibonacciKotlin;

    // Wasmモジュールのインポートを動的に行う
    import('./kotlin-wasm-fibonacci-example-wasm-js.mjs')
        .then(module => {
            fibonacciKotlin = module.fibonacciKotlin;
            console.log('Wasmモジュールが正常にインポートされました。');
        })
        .catch(error => {
            console.error('Wasmモジュールのインポートに失敗しました:', error);
        });

    /**
     * フィボナッチ数を再帰的に計算する関数（メモ化なし）
     */
    function fibonacciJs(n) {
        return n <= 1 ? n : fibonacciJs(n - 1) + fibonacciJs(n - 2);
    }

    /**
     * フィボナッチ数列を生成する関数
     * @param {number} n - 計算する項数
     * @returns {number[]} フィボナッチ数列の配列
     */
    function generateFibonacciJavaScript(n) {
        const sequence = [];
        for (let i = 0; i < n; i++) {
            sequence.push(fibonacciJs(i));
        }
        return sequence;
    }

    /**
     * フィボナッチ数列を生成する関数（Kotlin Wasm）
     * @param {number} n - 計算する項数
     * @returns {number[]} フィボナッチ数列の配列
     */
    function generateFibonacciWasm(n) {
        const sequence = [];
        for (let i = 0; i < n; i++) {
            sequence.push(fibonacciKotlin(i));
        }
        return sequence;
    }

    function displayResult(method, sequence, time) {
        if (method === 'javaScript') {
            document.getElementById('javaScriptSequence').textContent = sequence.join(', ');
            document.getElementById('javaScriptTime').textContent = `計算にかかった時間: ${time.toFixed(3)} ミリ秒`;
        } else if (method === 'wasm') {
            document.getElementById('wasmSequence').textContent = sequence.join(', ');
            document.getElementById('wasmTime').textContent = `計算にかかった時間: ${time.toFixed(3)} ミリ秒`;
        }
    }

    /**
     * 計算ボタンのクリックイベントハンドラー
     */
    function handleCalculateButtonClick() {
        const input = document.getElementById('numberInput').value;
        const n = parseInt(input, 10);
        console.log('計算する項数:', n);

        // JavaScriptの計算
        const startJavaScript = performance.now();
        const javaScriptSequence = generateFibonacciJavaScript(n);
        const endJavaScript = performance.now();
        const timeJavaScript = endJavaScript - startJavaScript;
        displayResult('javaScript', javaScriptSequence, timeJavaScript);

        // Kotlin Wasmの計算
        const startWasm = performance.now();
        const wasmSequence = generateFibonacciWasm(n);
        const endWasm = performance.now();
        const timeWasm = endWasm - startWasm;
        displayResult('wasm', wasmSequence, timeWasm);

    }

    /**
     * 初期化関数: イベントリスナーを設定する
     */
    function init() {
        const calculateBtn = document.getElementById('calculateBtn');
        if (calculateBtn) {
            calculateBtn.addEventListener('click', handleCalculateButtonClick);
            console.log('計算ボタンのイベントリスナーが設定されました。');
        } else {
            console.error('計算ボタンが見つかりません。');
        }
    }

    // ページが読み込まれたら初期化関数を実行
    document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
